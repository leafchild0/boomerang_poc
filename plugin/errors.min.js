!function(a,b){"use strict";a.ErrorStackParser=b()}(this,function(){"use strict";function a(a,b,c){if("function"==typeof Array.prototype.map)return a.map(b,c);for(var d=new Array(a.length),e=0;e<a.length;e++)d[e]=b.call(c,a[e]);return d}function b(a,b,c){if("function"==typeof Array.prototype.filter)return a.filter(b,c);for(var d=[],e=0;e<a.length;e++)b.call(c,a[e])&&d.push(a[e]);return d}var c=/(^|@)\S+\:\d+/,d=/^\s*at .*(\S+\:\d+|\(native\))/m,e=/^(eval@)?(\[native code\])?$/;return{parse:function(a){if(void 0!==a.stacktrace||void 0!==a["opera#sourceloc"])return this.parseOpera(a);if(a.stack&&a.stack.match(d))return this.parseV8OrIE(a);if(a.stack)return this.parseFFOrSafari(a);throw new Error("Cannot parse given Error object")},extractLocation:function(a){if(-1===a.indexOf(":"))return[a];var b=a.replace(/[\(\)\s]/g,"").split(":"),c=b.pop(),d=b[b.length-1];if(!isNaN(parseFloat(d))&&isFinite(d)){var e=b.pop();return[b.join(":"),e,c]}return[b.join(":"),c,void 0]},parseV8OrIE:function(c){return a(b(c.stack.split("\n"),function(a){return!!a.match(d)},this),function(a){a.indexOf("(eval ")>-1&&(a=a.replace(/eval code/g,"eval").replace(/(\(eval at [^\()]*)|(\)\,.*$)/g,""));var b=a.replace(/^\s+/,"").replace(/\(eval code/g,"(").split(/\s+/).slice(1),c=this.extractLocation(b.pop());return{functionName:b.join(" ")||void 0,fileName:"eval"===c[0]?void 0:c[0],lineNumber:c[1],columnNumber:c[2],source:a}},this)},parseFFOrSafari:function(c){return a(b(c.stack.split("\n"),function(a){return!a.match(e)},this),function(a){a.indexOf(" > eval")>-1&&(a=a.replace(/ line (\d+)(?: > eval line \d+)* > eval\:\d+\:\d+/g,":$1"));if(-1===a.indexOf("@")&&-1===a.indexOf(":"))return{functionName:a};var b=a.split("@"),c=this.extractLocation(b.pop());return{functionName:b.join("@")||void 0,fileName:c[0],lineNumber:c[1],columnNumber:c[2],source:a}},this)},parseOpera:function(a){return!a.stacktrace||a.message.indexOf("\n")>-1&&a.message.split("\n").length>a.stacktrace.split("\n").length?this.parseOpera9(a):a.stack?this.parseOpera11(a):this.parseOpera10(a)},parseOpera9:function(a){for(var b=/Line (\d+).*script (?:in )?(\S+)/i,c=a.message.split("\n"),d=[],e=2,f=c.length;e<f;e+=2){var g=b.exec(c[e]);g&&d.push({fileName:g[2],lineNumber:g[1],source:c[e]})}return d},parseOpera10:function(a){for(var b=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,c=a.stacktrace.split("\n"),d=[],e=0,f=c.length;e<f;e+=2){var g=b.exec(c[e]);g&&d.push({functionName:g[3]||void 0,fileName:g[2],lineNumber:g[1],source:c[e]})}return d},parseOpera11:function(d){return a(b(d.stack.split("\n"),function(a){return!!a.match(c)&&!a.match(/^Error created at/)},this),function(a){var b,c=a.split("@"),d=this.extractLocation(c.pop()),e=c.shift()||"",f=e.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^\)]*\)/g,"")||void 0;e.match(/\(([^\)]*)\)/)&&(b=e.replace(/^[^\(]+\(([^\)]*)\)$/,"$1"));return{functionName:f,args:void 0===b||"[arguments not available]"===b?void 0:b.split(","),fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:a}},this)}}});!function(){function a(a){a=a||{};"number"==typeof a.count||"string"==typeof a.count?this.count=parseInt(a.count,10):this.count=1;"number"==typeof a.timestamp?this.timestamp=a.timestamp:this.timestamp=BOOMR.now();"number"!=typeof a.code&&"string"!=typeof a.code||(this.code=parseInt(a.code,10));"string"==typeof a.message&&(this.message=a.message);"string"==typeof a.functionName&&(this.functionName=a.functionName);"string"==typeof a.fileName&&(this.fileName=a.fileName);"number"!=typeof a.lineNumber&&"string"!=typeof a.lineNumber||(this.lineNumber=parseInt(a.lineNumber,10));"number"!=typeof a.columnNumber&&"string"!=typeof a.columnNumber||(this.columnNumber=parseInt(a.columnNumber,10));"string"==typeof a.stack&&(this.stack=a.stack);"string"==typeof a.type&&(this.type=a.type);void 0!==a.extra&&(this.extra=a.extra);this.source="number"==typeof a.source||"string"==typeof a.source?parseInt(a.source,10):BOOMR.plugins.Errors.SOURCE_APP;"number"!=typeof a.via&&"string"!=typeof a.via||(this.via=parseInt(a.via,10));BOOMR.utils.isArray(a.frames)?this.frames=a.frames:this.frames=[];BOOMR.utils.isArray(a.events)?this.events=a.events:this.events=[]}var b;BOOMR=window.BOOMR||{};BOOMR.plugins=BOOMR.plugins||{};if(!BOOMR.plugins.Errors){var c=["BOOMR_addError","createStackForSend","BOOMR.window.console.error","BOOMR.plugins.Errors.init","BOOMR.window.onerror","BOOMR_plugins_errors_"],d=["Object.send","b.send","wrap","Anonymous function"],e=["/boomerang"],f=5e3;a.prototype.equals=function(a){return"object"==typeof a&&(this.code===a.code&&(this.message===a.message&&(this.functionName===a.functionName&&(this.fileName===a.fileName&&(this.lineNumber===a.lineNumber&&(this.columnNumber===a.columnNumber&&(this.stack===a.stack&&(this.type===a.type&&this.source===a.source))))))))};a.fromError=function(b,g,h){var i,j,k,l,m,n,o,p,q=!1,r=BOOMR.now();if(!b)return null;if(b.stack){b.stack.length>f&&(b.stack=b.stack.substr(0,f));j=ErrorStackParser.parse(b);if(j&&j.length){if(b.generatedStack){if(j.length>=4&&j[1].functionName&&-1!==j[1].functionName.indexOf("createStackForSend")){j=j.slice(3);q=!0}if(j.length>=3&&j[0].functionName&&-1!==j[0].functionName.indexOf("createStackForSend")){j=j[1].fileName===j[2].fileName?j.slice(3):j.slice(2);q=!0}if(j.length>=1&&j[0].functionName&&-1!==j[0].functionName.indexOf("BOOMR_plugins_errors")){j=j.slice(1);q=!0}}for(k=0;k<j.length;k++){o=j[k];p=o.functionName;n=!1;if(p){for(l=0;l<c.length;l++)if(-1!==p.indexOf(c[l])){j.splice(k,1);q=!0;k--;n=!0;break}if(!n&&o.fileName)for(l=0;l<e.length;l++)if(-1!==o.fileName.indexOf(e[l]))for(m=0;m<d.length;m++)if(-1!==p.indexOf(d[m])){j.splice(k,1);q=!0;k--;n=!0;break}}}if(j.length){i=j[0];(q||void 0===b.lineNumber)&&(b.lineNumber=i.lineNumber);(q||void 0===b.columnNumber)&&(b.columnNumber=i.columnNumber);(q||void 0===b.functionName)&&(b.functionName=i.functionName);(q||void 0===b.fileName)&&(b.fileName=i.fileName)}b.stack&&(b.stack=b.stack.replace(/\s\s+/g," "))}}else(b.functionName||b.fileName||b.lineNumber||b.columnNumber)&&(j=[{lineNumber:b.lineNumber,columnNumber:b.columnNumber,fileName:b.fileName,functionName:b.functionName}]);"string"==typeof b.message&&-1!==b.message.indexOf("ReferenceError:")&&"Error"===b.name&&(b.name="ReferenceError");return new a({code:b.code?b.code:void 0,message:b.message?b.message:void 0,functionName:b.functionName?b.functionName:void 0,fileName:b.fileName?b.fileName:void 0,lineNumber:b.lineNumber?b.lineNumber:void 0,columnNumber:b.columnNumber?b.columnNumber:void 0,stack:b.stack?b.stack:void 0,type:b.name?b.name:void 0,source:h,via:g,frames:j,extra:b.extra?b.extra:void 0,timestamp:b.timestamp?b.timestamp:r})};b={onError:void 0,monitorGlobal:!0,monitorNetwork:!0,monitorConsole:!0,monitorEvents:!0,monitorTimeout:!0,monitorRejections:!1,monitorReporting:!1,sendAfterOnload:!1,maxErrors:10,sendInterval:1e3,sendIntervalDuringLoad:2500,sendIntervalId:-1,maxEvents:10,isDuringLoad:!0,initialized:!1,supported:!1,autorun:!0,errors:[],q:[],events:[],reportingObserver:void 0,send:function(a,c,d){function e(){try{throw Error(a)}catch(e){a=e;a.generatedStack=!0;a.timestamp=a.timestamp||f;b.addError(a,c,d)}}var f=BOOMR.now();if(a&&!0!==a.reported){a.reported=!0;c=c||BOOMR.plugins.Errors.VIA_APP;d=d||BOOMR.plugins.Errors.SOURCE_APP;if(a.stack||a.noStack){a.timestamp=a.timestamp||f;b.addError(a,c,d)}else e()}},addError:function(c,d,e){var f,g,h=!1,i=BOOMR.now();if(b.isDuringLoad||b.sendAfterOnload){if(b.onError){try{f=b.onError(c)}catch(j){f=!1}if(!f)return}if(!(b.errors.length>=b.maxErrors)){g=a.fromError(c,d,e);h=b.mergeDuplicateErrors(b.errors,g,!1);BOOMR.fireEvent("error",h||g);b.mergeDuplicateErrors(b.q,g,!0);if(!(b.isDuringLoad&&b.autorun||-1!==b.sendIntervalId)){if(h)return;b.sendIntervalId=setTimeout(function(){b.sendIntervalId=-1;if(0!==b.q.length){BOOMR.addVar("http.initiator","error");BOOMR.addVar("api",1);b.addErrorsToBeacon();if(b.isDuringLoad){BOOMR.addVar("rt.tstart",i);BOOMR.addVar("rt.end",i);BOOMR.addVar("rt.start","manual")}BOOMR.sendBeacon()}},b.isDuringLoad?b.sendIntervalDuringLoad:b.sendInterval)}}}},findDuplicateError:function(a,b){if(BOOMR.utils.isArray(a)&&void 0!==b)for(var c=0;c<a.length;c++)if(a[c].equals(b))return a[c]},mergeDuplicateErrors:function(a,c,d){if(BOOMR.utils.isArray(a)&&void 0!==c){var e=b.findDuplicateError(a,c);if(e){d&&(e.count+=c.count);return e}a.push(c)}},onBeacon:function(){BOOMR.removeVar("err");BOOMR.removeVar("api");BOOMR.removeVar("http.initiator")},pageReady:function(){b.isDuringLoad=!1},getErrors:function(){return 0!==b.errors.length&&b.errors},getErrorsForUrl:function(a){a=b.compressErrors(a);return BOOMR.utils.serializeForUrl(a)},addErrorsToBeacon:function(){if(b.q.length){var a=this.getErrorsForUrl(b.q);a&&BOOMR.addVar("err",a);b.q=[]}},beforeBeacon:function(){b.addErrorsToBeacon()},wrapFn:function(a,c,d,e,f){var g=c[a];if("function"==typeof g){var h;"addEventListener"===a&&(h=c.removeEventListener);c[a]=function(){try{var i=Array.prototype.slice.call(arguments),j=i[e],k=d?this===window?BOOMR.window:this:c,l=b.wrap(j,k,f);i[e]=l;if("addEventListener"===a){if(!b.trackFn(k,i[0],j,i[2],l))return;h&&h.apply(k,arguments)}return g.apply(k,i)}catch(m){b.send(m,f);throw m}}}},trackFn:function(a,c,d,e,f){if(!a)return!1;if(-1!==b.trackedFnIdx(a,c,d,e))return!1;a._bmrEvents||(a._bmrEvents=[]);e=!0===(e&&e.capture||e);a._bmrEvents.push([c,d,e,f]);return!0},trackedFnIdx:function(a,b,c,d){var e,f;if(a){a._bmrEvents||(a._bmrEvents=[]);d=!0===(d&&d.capture||d);for(e=0;e<a._bmrEvents.length;e++){f=a._bmrEvents[e];if(f[0]===b&&f[1]===c&&f[2]===d)return e}return-1}},wrapRemoveEventListener:function(a){var c,d,e="removeEventListener",f=a[e];"function"==typeof f&&(a[e]=function(a,e,g){var h=this===window?BOOMR.window:this;c=b.trackedFnIdx(h,a,e,g);if(-1!==c){d=h._bmrEvents[c][3];f.call(h,a,d,g);h._bmrEvents.splice(c,1)}else f.call(h,a,e,g)})},wrap:function(a,c,d){if("function"!=typeof a)return a;d=d||BOOMR.plugins.Errors.VIA_APP;BOOMR_check_doc_domain();return function(){try{return a.apply(c,arguments)}catch(e){if(-2146823277===e.number&&(d===BOOMR.plugins.Errors.VIA_EVENTHANDLER||d===BOOMR.plugins.Errors.VIA_TIMEOUT))return;b.send(e,d);throw e}}},test:function(){var a,c,d;if(0!==arguments.length){a=arguments[0];if("function"==typeof a){c=arguments.length>1?arguments[1]:BOOMR.window;var d=Array.prototype.slice.call(arguments,2);return b.wrap(a,c).apply(c,d)}}},normalizeToString:function(a){return void 0===a?"undefined":null===a?"null":"number"==typeof a&&isNaN(a)?"NaN":""===a?"(empty string)":0===a?"0":a?"function"==typeof a?"(function)":a&&"function"==typeof a.toString?a.toString():"(unknown)":"false"},compressErrors:function(a){var b,c,d,e,f,g,h,i,j,k=0;i=BOOMR.window.location.origin;for(b=0;b<a.length;b++){d=a[b];j={};1!==d.count&&(j.n=d.count);if("number"==typeof d.timestamp){k=d.timestamp;j.d=d.timestamp.toString(36)}if(d.frames.length){j.f=[];for(c=0;c<d.frames.length;c++){e=d.frames[c];e.lineNumber&&(e.lineNumber=parseInt(e.lineNumber,10));e.columnNumber&&(e.columnNumber=parseInt(e.columnNumber,10));g={l:e.lineNumber,c:e.columnNumber};"string"==typeof e.fileName&&(-1!==e.fileName.indexOf(i)?g.wo=e.fileName.replace(i,""):g.w=e.fileName);"string"==typeof e.functionName&&(g.f=e.functionName);j.f.push(g)}}if(d.events.length){j.e=[];for(c=0;c<d.events.length;c++){f=d.events[c];h={t:f.type,d:k?k-f.timestamp:f.timestamp};if(f.type===BOOMR.plugins.Errors.EVENT_CLICK){f.id&&(h.i=f.id);f.name&&(h.n=f.name);f.tagName&&(h.g=f.tagName)}else if(f.type===BOOMR.plugins.Errors.EVENT_NETWORK){f.url&&(h.u=f.url);f.method&&(h.m=f.method);f.result&&(h.r=f.result)}else if(f.type===BOOMR.plugins.Errors.EVENT_LOG){f.severity&&(h.s=f.severity);f.message&&(h.m=f.message)}j.e.push(h)}}d.source!==BOOMR.plugins.Errors.SOURCE_APP&&(j.s=d.source);void 0!==d.via&&d.via!==BOOMR.plugins.Errors.VIA_APP&&(j.v=d.via);void 0!==d.type&&"Error"!==d.type&&(j.t=d.type);d.code&&(j.c=d.code);d.message&&(j.m=d.message);d.extra&&(j.x=d.extra);a[b]=j}return a},decompressErrors:function(a){var b,c,d,e,f;f=BOOMR.window.location.origin;for(b=0;b<a.length;b++){d=a[b];d.n?d.count=parseInt(d.n,10):d.count=1;d.d&&(d.timestamp=parseInt(d.d,36));d.frames=[];d.m&&(d.message=d.m);d.stack=d.message?d.message+" ":"";if(d.f){for(c=0;c<d.f.length;c++){e=d.f[c];e.l&&(e.lineNumber=parseInt(e.l,10));e.c&&(e.columnNumber=parseInt(e.c,10));e.f&&(e.functionName=e.f);e.w&&(e.fileName=e.w);e.wo&&(e.fileName=f+e.wo);delete e.c;delete e.l;delete e.f;delete e.w;delete e.wo;d.frames.push(e);0!==c&&(d.stack+="\n");d.stack+="at";e.functionName&&(d.stack+=" "+e.functionName);e.functionName&&e.fileName?d.stack+=" ("+e.fileName:!e.functionName&&e.fileName&&(d.stack+=" "+e.fileName);e.lineNumber&&(d.stack+=":"+e.lineNumber);e.columnNumber&&(d.stack+=":"+e.columnNumber);e.functionName&&e.fileName&&(d.stack+=")")}d.lineNumber=d.frames[0].lineNumber;d.columnNumber=d.frames[0].columnNumber;d.functionName=d.frames[0].functionName;d.fileName=d.frames[0].fileName}d.events=d.e||[];d.source=d.s?d.s:BOOMR.plugins.Errors.SOURCE_APP;d.via=d.v?d.v:BOOMR.plugins.Errors.VIA_APP;d.type=d.t?d.t:"Error";d.x&&(d.extra=d.x);d.c&&(d.code=parseInt(d.c,10));delete d.c;delete d.f;delete d.e;delete d.s;delete d.v;delete d.t;delete d.m;delete d.n;delete d.x;delete d.d}return a}};var g=BOOMR.plugins.Errors={init:function(a){var c,d,e;BOOMR.utils.pluginConfig(b,a,"Errors",["onError","monitorGlobal","monitorNetwork","monitorConsole","monitorEvents","monitorTimeout","monitorReporting","monitorRejections","sendAfterOnload","sendInterval","maxErrors"]);if(b.initialized)return this;a&&void 0!==a.autorun&&(b.autorun=a.autorun);b.initialized=!0;b.supported=!0;if(!b.supported)return this;BOOMR.subscribe("before_beacon",b.beforeBeacon,null,b);BOOMR.subscribe("beacon",b.onBeacon,null,b);BOOMR.subscribe("page_ready",b.pageReady,null,b);BOOMR.registerEvent("error");if(b.monitorGlobal)try{BOOMR.globalOnError?BOOMR.window.onerror&&!BOOMR.window.onerror._bmr&&(BOOMR.globalOnError=BOOMR.window.onerror):BOOMR.globalOnError=BOOMR.window.onerror;BOOMR.window.onerror=function(a,c,d,e,f){void 0===f&&"object"==typeof a&&"object"==typeof a.error&&null!==a.error&&(f=a.error);void 0!==f&&null!==f?b.send(f,g.VIA_GLOBAL_EXCEPTION_HANDLER):b.send({message:a,fileName:c,lineNumber:d,columnNumber:e,noStack:!0},g.VIA_GLOBAL_EXCEPTION_HANDLER);return"function"==typeof BOOMR.globalOnError&&BOOMR.globalOnError.apply(BOOMR.window,arguments)};if(BOOMR.globalErrors){for(var c=0;c<BOOMR.globalErrors.length;c++)b.send(BOOMR.globalErrors[c],g.VIA_GLOBAL_EXCEPTION_HANDLER);delete BOOMR.globalErrors}}catch(h){BOOMR.debug("Exception in the window.onerror handler","Errors")}b.monitorNetwork&&BOOMR.subscribe("xhr_error",function(a){b.send({code:a.status,message:a.url,noStack:!0},g.VIA_NETWORK)});b.monitorRejections&&BOOMR.window.PromiseRejectionEvent&&BOOMR.utils.addListener(BOOMR.window,"unhandledrejection",function(a){var c,d="Unhandled Promise Rejection";if(a&&a.reason){if("string"==typeof a.reason)d=a.reason;else{"string"==typeof a.reason.stack&&(c=a.reason.stack);d=void 0===a.reason.message?b.normalizeToString(a.reason):b.normalizeToString(a.reason.message)}b.send({message:d,stack:c,noStack:!c},g.VIA_REJECTION)}},!0);if(b.monitorConsole){BOOMR.window.console||(BOOMR.window.console={});var f=BOOMR.window.console.error;try{BOOMR.window.console.error=function(){var a=Array.prototype.slice.call(arguments);1===a.length?b.send(b.normalizeToString(a[0]),g.VIA_CONSOLE):b.send(b.normalizeToString(a),g.VIA_CONSOLE);"function"==typeof f&&("function"==typeof f.apply?f.apply(this,a):f(a[0],a[1],a[2]))}}catch(i){BOOMR.debug("Exception in the window.console.error handler","Errors")}}if(b.monitorEvents)if(BOOMR.window.EventTarget){b.wrapFn("addEventListener",BOOMR.window.EventTarget.prototype,!0,1,g.VIA_EVENTHANDLER);b.wrapRemoveEventListener(BOOMR.window.EventTarget.prototype)}else{if(BOOMR.window){b.wrapFn("addEventListener",BOOMR.window,!1,1,g.VIA_EVENTHANDLER);b.wrapRemoveEventListener(BOOMR.window)}if(BOOMR.window.Node){b.wrapFn("addEventListener",BOOMR.window.Node.prototype,!0,1,g.VIA_EVENTHANDLER);b.wrapRemoveEventListener(BOOMR.window.Node.prototype)}if(BOOMR.window.XMLHttpRequest){b.wrapFn("addEventListener",BOOMR.window.XMLHttpRequest.prototype,!0,1,g.VIA_EVENTHANDLER);b.wrapRemoveEventListener(BOOMR.window.XMLHttpRequest.prototype)}}if(b.monitorTimeout){b.wrapFn("setTimeout",BOOMR.window,!1,0,g.VIA_TIMEOUT);b.wrapFn("setInterval",BOOMR.window,!1,0,g.VIA_TIMEOUT)}if(b.monitorReporting&&BOOMR.window.ReportingObserver){b.reportingObserver=new BOOMR.window.ReportingObserver(function(a,f){if(BOOMR.utils.isArray(a))for(c=0;c<a.length;c++){d=a[c];e=d&&d.body&&(d.body.message||d.body.reason);e&&b.send({message:e,fileName:d.body.sourceFile||d.url,lineNumber:d.body.lineNumber,columnNumber:d.body.columnNumber,noStack:!0},g.VIA_REPORTING_API)}},{buffered:!0});b.reportingObserver.observe()}return this},is_complete:function(){return!0},is_supported:function(){return b.initialized&&b.supported},SOURCE_APP:1,SOURCE_BOOMERANG:2,VIA_APP:1,VIA_GLOBAL_EXCEPTION_HANDLER:2,VIA_NETWORK:3,VIA_CONSOLE:4,VIA_EVENTHANDLER:5,VIA_TIMEOUT:6,VIA_REJECTION:7,VIA_REPORTING_API:8,EVENT_CLICK:1,EVENT_NETWORK:2,EVENT_LOG:3,send:b.send,wrap:b.wrap,test:b.test,BoomerangError:a,BoomerangError:a,findDuplicateError:b.findDuplicateError,mergeDuplicateErrors:b.mergeDuplicateErrors,compressErrors:b.compressErrors,decompressErrors:b.decompressErrors,normalizeToString:b.normalizeToString}}}();
//# sourceMappingURL=errors.min.js.map